import{createPinia as e,defineStore as t,storeToRefs as n}from'https://testingcf.jsdelivr.net/npm/pinia/+esm';var a={42:(e,t)=>{t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}},54:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n='',a=void 0!==t[5];return t[4]&&(n+='@supports ('.concat(t[4],') {')),t[2]&&(n+='@media '.concat(t[2],' {')),a&&(n+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),n+=e(t),a&&(n+='}'),t[2]&&(n+='}'),t[4]&&(n+='}'),n}).join('')},t.i=function(e,n,a,o,l){'string'==typeof e&&(e=[[null,e,void 0]]);var r={};if(a)for(var s=0;s<this.length;s++){var i=this[s][0];null!=i&&(r[i]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&r[d[0]]||(void 0!==l&&(void 0===d[5]||(d[1]='@layer'.concat(d[5].length>0?' '.concat(d[5]):'',' {').concat(d[1],'}')),d[5]=l),n&&(d[2]?(d[1]='@media '.concat(d[2],' {').concat(d[1],'}'),d[2]=n):d[2]=n),o&&(d[4]?(d[1]='@supports ('.concat(d[4],') {').concat(d[1],'}'),d[4]=o):d[4]=''.concat(o)),t.push(d))}},t}},93:e=>{e.exports=function(e){return e[1]}},106:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var a=n(93),o=n.n(a),l=n(54),r=n.n(l)()(o());r.push([e.id,'.custom-slider[data-v-45c9b088]{position:relative;width:100%;height:20px;display:flex;align-items:center;cursor:pointer;-webkit-tap-highlight-color:transparent}.track[data-v-45c9b088]{position:absolute;width:100%;height:4px;background-color:#555;border-radius:2px}.track-fill[data-v-45c9b088]{height:100%;background-color:#4caf50;border-radius:2px}.thumb[data-v-45c9b088]{position:absolute;width:16px;height:16px;background-color:#f1f1f1;border:2px solid #4caf50;border-radius:50%;transform:translateX(-50%);z-index:1;box-shadow:0 1px 3px rgba(0,0,0,0.2)}\n','']);const s=r},406:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var a=n(93),o=n.n(a),l=n(54),r=n.n(l)()(o());r.push([e.id,'.block[data-v-5185922b]{display:flex;flex-direction:column;gap:5px;margin:10px 0}.flex-container[data-v-5185922b]{display:flex;gap:10px;align-items:center}.flex-container>select[data-v-5185922b]{flex-grow:1}.button-group[data-v-5185922b]{display:flex;gap:10px;align-items:center;margin:10px 0}.menu_button[data-v-5185922b]{flex-grow:1;white-space:nowrap}\n','']);const s=r},424:(e,t,n)=>{function a(e,t){for(var n=[],a={},o=0;o<t.length;o++){var l=t[o],r=l[0],s={id:e+':'+o,css:l[1],media:l[2],sourceMap:l[3]};a[r]?a[r].parts.push(s):n.push(a[r]={id:r,parts:[s]})}return n}n.d(t,{A:()=>v});var o='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!o)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var l={},r=o&&(document.head||document.getElementsByTagName('head')[0]),s=null,i=0,c=!1,d=function(){},u=null,p='data-vue-ssr-id',m='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function v(e,t,n,o){c=n,u=o||{};var r=a(e,t);return f(r),function(t){for(var n=[],o=0;o<r.length;o++){var s=r[o];(i=l[s.id]).refs--,n.push(i)}t?f(r=a(e,t)):r=[];for(o=0;o<n.length;o++){var i;if(0===(i=n[o]).refs){for(var c=0;c<i.parts.length;c++)i.parts[c]();delete l[i.id]}}}}function f(e){for(var t=0;t<e.length;t++){var n=e[t],a=l[n.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](n.parts[o]);for(;o<n.parts.length;o++)a.parts.push(h(n.parts[o]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{var r=[];for(o=0;o<n.parts.length;o++)r.push(h(n.parts[o]));l[n.id]={id:n.id,refs:1,parts:r}}}}function g(){var e=document.createElement('style');return e.type='text/css',r.appendChild(e),e}function h(e){var t,n,a=document.querySelector('style['+p+'~="'+e.id+'"]');if(a){if(c)return d;a.parentNode.removeChild(a)}if(m){var o=i++;a=s||(s=g()),t=x.bind(null,a,o,!1),n=x.bind(null,a,o,!0)}else a=g(),t=w.bind(null,a),n=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else n()}}var b,V=(b=[],function(e,t){return b[e]=t,b.filter(Boolean).join('\n')});function x(e,t,n,a){var o=n?'':a.css;if(e.styleSheet)e.styleSheet.cssText=V(t,o);else{var l=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(l,r[t]):e.appendChild(l)}}function w(e,t){var n=t.css,a=t.media,o=t.sourceMap;if(a&&e.setAttribute('media',a),u.ssrId&&e.setAttribute(p,t.id),o&&(n+='\n/*# sourceURL='+o.sources[0]+' */',n+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */'),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},559:(e,t,n)=>{var a=n(106);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,n(424).A)('42487936',a,!1,{ssrId:!0})},987:(e,t,n)=>{var a=n(406);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,n(424).A)('2291492c',a,!1,{ssrId:!0})}},o={};function l(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={id:e,exports:{}};return a[e](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const r=Vue,s={class:'track'},i=(0,r.defineComponent)({__name:'CustomSlider',props:{modelValue:{},min:{},max:{},step:{}},emits:['update:modelValue'],setup(e,{emit:t}){const n=e,a=t,o=(0,r.ref)(null),l=(0,r.computed)(()=>{const e=n.max-n.min;return 0===e?0:(n.modelValue-n.min)/e}),i=(0,r.computed)(()=>100*Math.max(0,Math.min(1,l.value))+'%');function c(e){if(!o.value)return;const t=o.value.getBoundingClientRect(),l=Math.max(0,Math.min(1,(e-t.left)/t.width));const r=(n.min+l*(n.max-n.min)-n.min)/n.step,s=Math.round(r);let i=n.min+s*n.step;if(i=Math.max(n.min,Math.min(n.max,i)),i!==n.modelValue){const e=String(n.step).split('.')[1]?.length||0;a('update:modelValue',parseFloat(i.toFixed(e)))}}function d(e){c(e.clientX)}function u(e){c('touches'in e?e.touches[0].clientX:e.clientX)}function p(){window.removeEventListener('mousemove',u),window.removeEventListener('touchmove',u),window.removeEventListener('mouseup',p),window.removeEventListener('touchend',p)}function m(){window.addEventListener('mousemove',u),window.addEventListener('touchmove',u),window.addEventListener('mouseup',p),window.addEventListener('touchend',p)}return(0,r.onUnmounted)(()=>{p()}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{ref_key:'sliderRef',ref:o,class:'custom-slider',onClick:d},[(0,r.createElementVNode)('div',s,[(0,r.createElementVNode)('div',{class:'track-fill',style:(0,r.normalizeStyle)({width:i.value})},null,4)]),(0,r.createElementVNode)('div',{class:'thumb',style:(0,r.normalizeStyle)({left:i.value}),onMousedown:(0,r.withModifiers)(m,['prevent']),onTouchstart:(0,r.withModifiers)(m,['prevent'])},null,36)],512))}});l(559);var c=l(42);const d=(0,c.A)(i,[['__scopeId','data-v-45c9b088']]),u=z,p=u.z.object({autoOptimize:u.z.boolean().default(!1),apiProvider:u.z.enum(['openai','openai_test','google','sillytavern_backend','sillytavern_preset']).default('openai'),apiUrl:u.z.string().url().optional().or(u.z.literal('')).default(''),apiKey:u.z.string().default(''),modelName:u.z.string().default(''),autoFetchModels:u.z.boolean().default(!1),disabledWords:u.z.string().default(''),regexFilters:u.z.string().default(['<StatusPlaceHolderImpl\\/>','\\s*\x3c!--[\\s\\S]*?--\x3e\\s*','(<disclaimer>.*?<\\/disclaimer>)|(<guifan>.*?<\\/guifan>)|```start|<content>|<\\/content>|```end|<done>|`<done>`|(\x3c!--\\s*consider\\s*:\\s*(.*?)\\s*--\x3e)|(.*?<\\/think(ing)?>(\\n)?)|(<think(ing)?>[\\s\\S]*?<\\/think(ing)?>(\\n)?)','/<UpdateVariable>[\\s\\S]*?<\\/UpdateVariable>/gm'].join('\n')),disableNotifications:u.z.boolean().default(!1),temperature:u.z.number().min(0).max(2).default(.7),max_tokens:u.z.number().int().positive().default(2e3),top_p:u.z.number().min(0).max(1).default(1),top_k:u.z.number().int().positive().optional(),promptSettings:u.z.object({main:u.z.string().default(''),system:u.z.string().default(''),final_system:u.z.string().default('')}).default({main:'你是一个专业的剧情优化助手。',system:'请根据用户的要求，优化提供的句子，使其更生动、更具描述性。',final_system:'只返回优化后的句子，不要包含任何额外的解释或标签。'})}),m=p.parse({});async function v(){const e=await TavernHelper.getVariables({type:'script'});return p.parse(e.settings||{})}const f=t('settings',()=>{const e=(0,r.ref)(m);return v().then(t=>{e.value=t}),(0,r.watch)(e,e=>{!async function(e){const t={...await v(),...e};await TavernHelper.updateVariablesWith(()=>({settings:t}),{type:'script'})}(e)},{deep:!0}),{settings:e}}),{getChatMessages:g,setChatMessages:h,generate:b,getLastMessageId:V}=TavernHelper;async function x(e,t){(await v()).disableNotifications&&'error'!==e||toastr[e](t)}async function w(e){const t=await v(),n=N(e,t),a=(t.disabledWords||'').split(',').map(e=>e.trim()).filter(Boolean);return 0!==a.length&&a.some(e=>{const t=e.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&');return new RegExp(t,'i').test(n)})}function N(e,t){const n=t.regexFilters||'';if(!n.trim())return e;const a=n.split('\n').map(e=>e.trim()).filter(e=>e.length>0);let o=e;for(const e of a)try{let t=e,n='gs';const a=e.match(/^\/(.*)\/([gimsuy]*)$/);a&&(t=a[1],n=''!==a[2]?a[2]:n);const l=new RegExp(t,n);o=o.replace(l,'')}catch(t){console.error(`[AI Optimizer] 无效的正则表达式: "${e}"`,t)}return o.trim()}async function y(e,t){x('info','正在发送给AI进行优化...');try{const n=await b({user_input:`待优化句子：\n${e}`,injects:[{role:'system',content:t,position:'in_chat',depth:0}]});return x('success','优化完成。'),n??''}catch(e){return console.error(e),x('error','优化失败，请查看控制台日志。'),''}}async function E(e,t,n){const a=await V(),o=await g(a);if(!o||0===o.length)return void x('error','未找到可替换的消息。');const l=o[0],r=e.split('\n').map(e=>e.replace(/^\d+[.)]\s*/,'').trim()).filter(Boolean),s=(t.match(/\d+[.)]\s*.*?(?=\s*\d+[.)]|$)/g)||[]).map(e=>e.replace(/^\d+[.)]\s*/,'').trim()).filter(Boolean);let i=l.message;if(r.length!==s.length){x('warning','AI返回的句子数量与原始数量不匹配，将尝试整体替换。');const e=r[0];if(!i.includes(e))return void x('error','找不到原始句子的起始位置，无法执行替换。');i=i.replace(e,t);for(let e=1;e<r.length;e++)i=i.replace(r[e],'')}else r.forEach((e,t)=>{const n=s[t];n&&(i=i.replace(e,n))});n(i),await h([{message_id:l.message_id,message:i}]),x('success','消息已成功替换！')}async function k(e){const t=await v(),n=await V(),a=await g(n);if(!a||0===a.length)return x('error','聊天记录为空，无法优化。'),void e('');const o=N(a[0].message,t),l=(t.disabledWords||'').split(',').map(e=>e.trim()).filter(Boolean);if(0===l.length)return x('warning','未设置禁用词，无法提取。'),void e('');const r=function(e,t){const n=e.match(/[^.!?。！？]+[.!?。！？]?/g)||[e],a=new Set;return t.forEach(e=>{const t=e.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&'),o=new RegExp(t,'i');n.forEach(e=>{if(o.test(e)){let t=e.replace(/[\r\n]/g,' ').trim();t=t.replace(/\*/g,''),t=t.replace(/^[\s"'“‘]+|[\s"'”’]+$/g,'').trim();const n=t.lastIndexOf('……');-1!==n&&n+2<t.length&&(t=t.substring(n+2)),t=t.replace(/^[\s"'“‘]+/,'').trim(),a.add(t)}})}),Array.from(a)}(o,l);if(r.length>0){x('success','已提取待优化内容。');e(r.map((e,t)=>`${t+1}. ${e}`).join('\n'))}else x('info','在最后一条角色消息中未找到包含禁用词的句子。'),e('')}async function M(){try{x('info','自动化优化流程已启动...');const e=await v(),t=await new Promise(e=>{k(e)});if(!t)return;const n=function(e){const t=(e.disabledWords||'').split(',').map(e=>e.trim()).filter(Boolean),{main:n,system:a,final_system:o}=e.promptSettings;return[n,a,`必须避免使用这些词：[${t.join(', ')}]`,o].filter(Boolean).join('\n')}(e),a=await y(t,n);if(!a)throw new Error('AI 未能返回优化后的文本。');await E(t,a,()=>{}),x('success','自动优化完成！')}catch(e){console.error('[Auto Optimizer] 流程执行出错:',e),x('error',e.message)}}async function S(){const e=await V(),t=await g(e);return t&&t.length>0?t[0].message:''}const A={class:'ai-optimizer-settings'},I={class:'inline-drawer'},C={class:'inline-drawer-content'},U={class:'block'},T={class:'block'},B={class:'block'},P={class:'block'},D={class:'block'},O={class:'block'},j={class:'block'},L={class:'button-group'},R={key:0,style:{color:'green'}},F={key:1,style:{color:'red'}},W={class:'block'},H=['value'],K=['value'],X={class:'checkbox_label'},G={class:'block'},q={class:'block'},J={class:'block'},Q={class:'button-group'},Y={class:'checkbox_label'},Z={class:'checkbox_label'},ee={class:'block'},te={class:'block'},ne={class:'block'},ae={class:'block'},oe=(0,r.defineComponent)({__name:'Panel',setup(e){const{settings:t}=n(f()),a=(0,r.ref)([]),o=(0,r.ref)('unknown'),l=(0,r.ref)('main'),s=(0,r.ref)(''),i=(0,r.ref)(''),c=(0,r.ref)(''),u=(0,r.ref)('');let p,m=(0,r.ref)('');(0,r.watch)(u,(e,n)=>{t.value.autoOptimize&&e&&e!==m.value&&w(e)&&(console.log('[AI Optimizer] Detected disabled word in new message, triggering auto-optimization.'),m.value=e,M())});const g=()=>{s.value&&i.value?E(s.value,i.value,e=>{c.value=e}):toastr.warning('“待优化内容”和“优化后内容”都不能为空。')},h=async()=>{if(s.value){toastr.info('正在发送给AI进行优化...');try{const e=await y(s.value,t.value.promptSettings[l.value]);i.value=e,toastr.success('优化完成。')}catch(e){console.error(e),toastr.error('优化失败，请查看控制台日志。')}}else toastr.warning('待优化内容不能为空。')},V=async()=>{toastr.info('正在获取模型列表...');try{const e=await async function(){const e=await v(),{apiProvider:t,apiUrl:n,apiKey:a,modelName:o}=e;try{if(await b({user_input:'test',max_chat_history:0,custom_api:{apiurl:n,key:a,model:o,source:t}}))switch(x('success','API连接成功，但无法动态获取模型列表。'),t){case'openai':case'openai_test':return['gpt-3.5-turbo','gpt-4','gpt-4-turbo-preview'];case'google':return['gemini-pro','gemini-1.5-pro-latest'];default:return[]}return[]}catch(e){return console.error('[AI Optimizer] 获取模型列表失败:',e),x('error','获取模型列表失败，请检查API设置和网络连接。'),[]}}();e.length>0?(a.value=e,toastr.success(`成功获取 ${e.length} 个模型。`)):toastr.warning('未能获取到模型列表，请检查设置或控制台日志。')}catch(e){console.error(e),toastr.error('获取模型时发生未知错误。')}},N=async()=>{o.value='unknown',toastr.info('正在测试连接...');try{const e=await async function(){try{return await b({user_input:'test',max_chat_history:0}),x('success','API 连接成功！'),!0}catch(e){return x('error','API 连接失败。'),!1}}();o.value=e?'success':'error',e?toastr.success('API 连接成功！'):toastr.error('API 连接失败，请检查设置和控制台日志。')}catch(e){o.value='error',toastr.error('API 连接测试时发生错误。'),console.error(e)}};return(0,r.onMounted)(()=>{t.value.autoFetchModels&&V(),u.value=S(),console.log('[AI Optimizer] Initial lastCharMessage:',u.value),p=window.setInterval(()=>{const e=S();e!==u.value&&(u.value=e,console.log('[AI Optimizer] lastCharMessage updated.'))},3e3)}),(0,r.onUnmounted)(()=>{p&&clearInterval(p)}),(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',A,[(0,r.createElementVNode)('div',I,[n[45]||(n[45]=(0,r.createElementVNode)('div',{class:'inline-drawer-toggle inline-drawer-header'},[(0,r.createElementVNode)('b',null,'AI 文本优化助手'),(0,r.createElementVNode)('div',{class:'inline-drawer-icon fa-solid fa-circle-chevron-down down'})],-1)),(0,r.createElementVNode)('div',C,[(0,r.createCommentVNode)(' 生成设置 '),n[38]||(n[38]=(0,r.createElementVNode)('b',null,'生成设置',-1)),(0,r.createElementVNode)('div',U,[(0,r.createElementVNode)('label',null,'Temperature ('+(0,r.toDisplayString)((0,r.unref)(t).temperature)+')',1),(0,r.createVNode)(d,{modelValue:(0,r.unref)(t).temperature,'onUpdate:modelValue':n[0]||(n[0]=e=>(0,r.unref)(t).temperature=e),min:0,max:2,step:.01,class:'text_pole'},null,8,['modelValue'])]),(0,r.createElementVNode)('div',T,[n[20]||(n[20]=(0,r.createElementVNode)('label',null,'Max Tokens',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':n[1]||(n[1]=e=>(0,r.unref)(t).max_tokens=e),class:'text_pole',type:'number'},null,512),[[r.vModelText,(0,r.unref)(t).max_tokens,void 0,{number:!0}]])]),(0,r.createElementVNode)('div',B,[(0,r.createElementVNode)('label',null,'Top P ('+(0,r.toDisplayString)((0,r.unref)(t).top_p)+')',1),(0,r.createVNode)(d,{modelValue:(0,r.unref)(t).top_p,'onUpdate:modelValue':n[2]||(n[2]=e=>(0,r.unref)(t).top_p=e),min:0,max:1,step:.01,class:'text_pole'},null,8,['modelValue'])]),(0,r.createElementVNode)('div',P,[n[21]||(n[21]=(0,r.createElementVNode)('label',null,'Top K',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':n[3]||(n[3]=e=>(0,r.unref)(t).top_k=e),class:'text_pole',type:'number'},null,512),[[r.vModelText,(0,r.unref)(t).top_k,void 0,{number:!0}]])]),n[39]||(n[39]=(0,r.createElementVNode)('hr',{class:'sysHR'},null,-1)),(0,r.createCommentVNode)(' API 设置 '),n[40]||(n[40]=(0,r.createElementVNode)('b',null,'API 设置',-1)),(0,r.createElementVNode)('div',D,[n[23]||(n[23]=(0,r.createElementVNode)('label',null,'API 提供商',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':n[4]||(n[4]=e=>(0,r.unref)(t).apiProvider=e),class:'text_pole'},[...n[22]||(n[22]=[(0,r.createStaticVNode)('<option value="openai" data-v-5185922b>OpenAI</option><option value="openai_test" data-v-5185922b>OpenAI (测试)</option><option value="google" data-v-5185922b>Google</option><option value="sillytavern_backend" data-v-5185922b>SillyTavern (后端)</option><option value="sillytavern_preset" data-v-5185922b>SillyTavern (预设)</option>',5)])],512),[[r.vModelSelect,(0,r.unref)(t).apiProvider]])]),(0,r.createElementVNode)('div',O,[n[24]||(n[24]=(0,r.createElementVNode)('label',null,'API URL',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':n[5]||(n[5]=e=>(0,r.unref)(t).apiUrl=e),class:'text_pole',type:'text',placeholder:'例如: https://api.openai.com/v1'},null,512),[[r.vModelText,(0,r.unref)(t).apiUrl]])]),(0,r.createElementVNode)('div',j,[n[25]||(n[25]=(0,r.createElementVNode)('label',null,'API 密钥',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':n[6]||(n[6]=e=>(0,r.unref)(t).apiKey=e),class:'text_pole',type:'password'},null,512),[[r.vModelText,(0,r.unref)(t).apiKey]])]),(0,r.createElementVNode)('div',L,[(0,r.createElementVNode)('button',{class:'menu_button',onClick:N},'测试连接'),(0,r.createElementVNode)('button',{class:'menu_button',onClick:V},'获取模型'),'success'===o.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',R,'连接成功！')):(0,r.createCommentVNode)('v-if',!0),'error'===o.value?((0,r.openBlock)(),(0,r.createElementBlock)('span',F,'连接失败。')):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('div',W,[n[27]||(n[27]=(0,r.createElementVNode)('label',null,'模型名称',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':n[7]||(n[7]=e=>(0,r.unref)(t).modelName=e),class:'text_pole'},[(0,r.unref)(t).modelName&&!a.value.includes((0,r.unref)(t).modelName)?((0,r.openBlock)(),(0,r.createElementBlock)('option',{key:0,value:(0,r.unref)(t).modelName},(0,r.toDisplayString)((0,r.unref)(t).modelName)+' (自定义) ',9,H)):(0,r.createCommentVNode)('v-if',!0),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)('option',{key:e,value:e},(0,r.toDisplayString)(e),9,K))),128))],512),[[r.vModelSelect,(0,r.unref)(t).modelName]]),(0,r.createElementVNode)('label',X,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':n[8]||(n[8]=e=>(0,r.unref)(t).autoFetchModels=e),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(t).autoFetchModels]]),n[26]||(n[26]=(0,r.createTextVNode)(' 每次加载时自动获取 ',-1))])]),n[41]||(n[41]=(0,r.createElementVNode)('hr',{class:'sysHR'},null,-1)),(0,r.createCommentVNode)(' 禁用词设置 '),n[42]||(n[42]=(0,r.createElementVNode)('b',null,'禁用词与优化',-1)),(0,r.createElementVNode)('div',G,[n[28]||(n[28]=(0,r.createElementVNode)('label',null,'禁用词列表 (用英文逗号 , 分隔)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':n[9]||(n[9]=e=>(0,r.unref)(t).disabledWords=e),class:'text_pole',rows:'3'},null,512),[[r.vModelText,(0,r.unref)(t).disabledWords]])]),(0,r.createElementVNode)('div',q,[n[29]||(n[29]=(0,r.createElementVNode)('label',null,'正则表达式过滤器 (每行一个)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':n[10]||(n[10]=e=>(0,r.unref)(t).regexFilters=e),class:'text_pole',rows:'5'},null,512),[[r.vModelText,(0,r.unref)(t).regexFilters]])]),(0,r.createElementVNode)('div',J,[n[30]||(n[30]=(0,r.createElementVNode)('label',null,'最后一条角色消息 (自动刷新)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':n[11]||(n[11]=e=>u.value=e),class:'text_pole',rows:'4',readonly:''},null,512),[[r.vModelText,u.value]])]),(0,r.createElementVNode)('div',Q,[(0,r.createElementVNode)('button',{class:'menu_button',onClick:n[12]||(n[12]=(...e)=>(0,r.unref)(M)&&(0,r.unref)(M)(...e))},'一键全自动优化'),(0,r.createElementVNode)('label',Y,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':n[13]||(n[13]=e=>(0,r.unref)(t).autoOptimize=e),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(t).autoOptimize]]),n[31]||(n[31]=(0,r.createTextVNode)(' 自动优化 ',-1))]),(0,r.createElementVNode)('label',Z,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':n[14]||(n[14]=e=>(0,r.unref)(t).disableNotifications=e),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(t).disableNotifications]]),n[32]||(n[32]=(0,r.createTextVNode)(' 关闭大部分通知 ',-1))])]),(0,r.createElementVNode)('div',ee,[n[33]||(n[33]=(0,r.createElementVNode)('label',null,'待优化内容',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':n[15]||(n[15]=e=>s.value=e),class:'text_pole',rows:'4'},null,512),[[r.vModelText,s.value]])]),(0,r.createElementVNode)('div',{class:'button-group'},[(0,r.createElementVNode)('button',{class:'menu_button',onClick:h},'优化')]),(0,r.createElementVNode)('div',te,[n[34]||(n[34]=(0,r.createElementVNode)('label',null,'优化后内容',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':n[16]||(n[16]=e=>i.value=e),class:'text_pole',rows:'4'},null,512),[[r.vModelText,i.value]])]),(0,r.createElementVNode)('div',{class:'button-group'},[(0,r.createElementVNode)('button',{class:'menu_button',onClick:g},'替换')]),(0,r.createElementVNode)('div',ne,[n[35]||(n[35]=(0,r.createElementVNode)('label',null,'修改后的消息内容 (测试)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':n[17]||(n[17]=e=>c.value=e),class:'text_pole',rows:'6'},null,512),[[r.vModelText,c.value]])]),n[43]||(n[43]=(0,r.createElementVNode)('hr',{class:'sysHR'},null,-1)),(0,r.createCommentVNode)(' 提示词编写器 '),n[44]||(n[44]=(0,r.createElementVNode)('b',null,'提示词编写器',-1)),(0,r.createElementVNode)('div',ae,[n[37]||(n[37]=(0,r.createElementVNode)('label',null,'选择编辑的提示词:',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':n[18]||(n[18]=e=>l.value=e),class:'text_pole'},[...n[36]||(n[36]=[(0,r.createElementVNode)('option',{value:'main'},'主系统提示词 (通用)',-1),(0,r.createElementVNode)('option',{value:'system'},'拦截任务详细指令',-1),(0,r.createElementVNode)('option',{value:'final_system'},'最终注入指令',-1)])],512),[[r.vModelSelect,l.value]]),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':n[19]||(n[19]=e=>(0,r.unref)(t).promptSettings[l.value]=e),class:'text_pole',rows:'6'},null,512),[[r.vModelText,(0,r.unref)(t).promptSettings[l.value]]])])])])]))}});l(987);const le=(0,c.A)(oe,[['__scopeId','data-v-5185922b']]);$(()=>{const t=e(),n=(0,r.createApp)(le);n.use(t);let a=$('#ai-optimizer-mount-point');0===a.length&&(a=$('<div id="ai-optimizer-mount-point"></div>'),$('body').append(a)),n.mount('#ai-optimizer-mount-point')});